<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Boutique Buend칤a | Iniciar sesi칩n</title>
<style>
  *{box-sizing:border-box;font-family:'Poppins',sans-serif;}
  body{
    margin:0;
    background:linear-gradient(135deg,#7c4dff,#b39ddb);
    height:100vh;
    display:flex;
    justify-content:center;
    align-items:center;
  }
  .container{
    background:#fff;
    border-radius:12px;
    box-shadow:0 8px 25px rgba(0,0,0,0.25);
    width:360px;
    padding:40px 30px;
    text-align:center;
    transition:0.5s;
    position:relative;
    overflow:hidden;
  }
  h1{color:#4a148c;margin-bottom:20px;}
  input{
    width:100%;
    padding:12px;
    margin:8px 0;
    border:1px solid #ccc;
    border-radius:6px;
    transition:0.2s;
    font-size:15px;
  }
  input:focus{border-color:#7c4dff;outline:none;box-shadow:0 0 5px #b39ddb;}
  button{
    width:100%;
    padding:12px;
    background:#7c4dff;
    color:white;
    border:none;
    border-radius:6px;
    font-size:16px;
    cursor:pointer;
    margin-top:10px;
    transition:0.3s;
  }
  button:hover{background:#6a1b9a;transform:scale(1.03);}
  #toggle{
    margin-top:15px;
    color:#4a148c;
    cursor:pointer;
    font-weight:500;
  }
  #toggle:hover{text-decoration:underline;}
  .shake{animation:shake 0.3s ease;}
  @keyframes shake{0%,100%{transform:translateX(0);}25%{transform:translateX(-5px);}75%{transform:translateX(5px);}}
  #info{margin-top:10px;font-weight:500;}
  #terms{margin-top:10px;font-size:13px;text-align:left;}
</style>
</head>
<body>

<div class="container" id="box">
  <h1 id="title">Iniciar sesi칩n</h1>
  <div id="form-login">
    <input type="text" id="usuario" placeholder="Nombre de usuario">
    <input type="password" id="password" placeholder="Contrase침a">
    <button id="btnLogin">Iniciar sesi칩n</button>
  </div>

  <div id="form-register" style="display:none;">
    <input type="text" id="newUser" placeholder="Nombre de usuario o correo">
    <input type="password" id="newPass" placeholder="Contrase침a">
    <input type="password" id="confirmPass" placeholder="Repetir contrase침a">
    <label id="terms">
      <input type="checkbox" id="accept"> Acepto t칠rminos y condiciones
    </label>
    <button id="btnRegister">Registrarse</button>
  </div>

  <div id="info"></div>
  <div id="toggle">쮼res nuevo? Reg칤strate aqu칤</div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
  import { getFirestore, collection, query, where, getDocs, addDoc } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBmv4Wtlg295lfsWh1vpDtOHkxMD34vmUE",
    authDomain: "boutique-buendia.firebaseapp.com",
    projectId: "boutique-buendia",
    storageBucket: "boutique-buendia.firebasestorage.app",
    messagingSenderId: "430651152709",
    appId: "1:430651152709:web:aaa54eeb8e3ba64c43062c",
    measurementId: "G-9KJ2330RN7"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const ADMIN_USER = "Buendia*]?~?춲u837jwhwi";
  const ADMIN_PASS = "&2)3)8:&?3828&/82$:!";

  const info = document.getElementById("info");
  const toggle = document.getElementById("toggle");
  const formLogin = document.getElementById("form-login");
  const formRegister = document.getElementById("form-register");
  const title = document.getElementById("title");

  // 游댃 Cambiar entre login y registro
  let mode = "login";
  toggle.onclick = () => {
    if (mode === "login") {
      formLogin.style.display = "none";
      formRegister.style.display = "block";
      title.textContent = "Crear cuenta";
      toggle.textContent = "쯏a tienes cuenta? Inicia sesi칩n";
      info.textContent = "";
      mode = "register";
    } else {
      formLogin.style.display = "block";
      formRegister.style.display = "none";
      title.textContent = "Iniciar sesi칩n";
      toggle.textContent = "쮼res nuevo? Reg칤strate aqu칤";
      info.textContent = "";
      mode = "login";
    }
  };

  // 游댏 Inicio de sesi칩n
  document.getElementById("btnLogin").addEventListener("click", async () => {
    const user = document.getElementById("usuario");
    const pass = document.getElementById("password");
    const u = user.value.trim();
    const p = pass.value.trim();

    if (!u || !p) {
      info.textContent = "Completa todos los campos.";
      info.style.color = "#e53935";
      return;
    }

    if (u === ADMIN_USER && p === ADMIN_PASS) {
      info.style.color = "green";
      info.textContent = "Bienvenido, administrador...";
      setTimeout(() => window.location.href = "admin.html", 2000);
      return;
    }

    const q = query(collection(db, "usuarios"), where("nombre", "==", u));
    const snap = await getDocs(q);

    if (snap.empty) {
      info.textContent = "Usuario no encontrado.";
      info.style.color = "#e53935";
      user.classList.add("shake");
      setTimeout(() => user.classList.remove("shake"), 300);
      return;
    }

    const data = snap.docs[0].data();
    if (data.contrase침a !== p) {
      info.textContent = "Contrase침a incorrecta.";
      info.style.color = "#e53935";
      pass.classList.add("shake");
      setTimeout(() => pass.classList.remove("shake"), 300);
      return;
    }

    info.style.color = "green";
    info.textContent = "Inicio exitoso, redirigiendo...";
    setTimeout(() => window.location.href = "index.html", 2000);
  });

  // 游닇 Registro de nuevo usuario
  document.getElementById("btnRegister").addEventListener("click", async () => {
    const newUser = document.getElementById("newUser").value.trim();
    const newPass = document.getElementById("newPass").value.trim();
    const confirmPass = document.getElementById("confirmPass").value.trim();
    const accept = document.getElementById("accept").checked;

    info.style.color = "#e53935";

    if (!newUser || !newPass || !confirmPass) {
      info.textContent = "Completa todos los campos.";
      return;
    }
    if (newPass !== confirmPass) {
      info.textContent = "Las contrase침as no coinciden.";
      return;
    }
    if (!accept) {
      info.textContent = "Debes aceptar los t칠rminos.";
      return;
    }

    const q = query(collection(db, "usuarios"), where("nombre", "==", newUser));
    const snap = await getDocs(q);
    if (!snap.empty) {
      info.textContent = "Usuario ya registrado. Inicia sesi칩n.";
      return;
    }

    try {
      await addDoc(collection(db, "usuarios"), {
        nombre: newUser,
        contrase침a: newPass,
        fechaRegistro: new Date().toISOString()
      });
      info.style.color = "green";
      info.textContent = "Registro exitoso. Redirigiendo...";
      setTimeout(() => window.location.href = "index.html", 2000);
    } catch (err) {
      info.textContent = "Error: " + err.message;
    }
  });
</script>

</body>
</html>
