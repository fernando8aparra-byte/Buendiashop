<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Panel</title>
<style>
:root {
  --bg: #ffffff;
  --text: #111;
  --card-bg: #fff;
  --accent: #7c4dff;
  --shadow: 0 8px 20px rgba(0,0,0,0.08);
}
body {
  background: var(--bg);
  font-family: "Inter", sans-serif;
  padding: 20px;
}
h1 { text-align:center; margin-bottom:20px; }
table {
  width: 100%;
  border-collapse: collapse;
  box-shadow: var(--shadow);
  background: var(--card-bg);
  border-radius: 8px;
  overflow: hidden;
}
th, td {
  padding: 12px;
  border-bottom: 1px solid #ddd;
  text-align: left;
}
th {
  background: var(--accent);
  color: #fff;
}
tr:hover { background:#f2f2f2; }
.total-users { margin: 20px 0; font-weight: 700; font-size: 16px; }
button.logout {
  padding: 8px 12px;
  background: red;
  color: #fff;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-weight: 600;
  float: right;
}
</style>
</head>
<body>

<h1>Panel de Administrador</h1>
<button class="logout" onclick="logout()">Cerrar Sesi√≥n</button>
<div class="total-users" id="total-users"></div>
<table>
  <thead>
    <tr>
      <th>Nombre</th>
      <th>Email</th>
      <th>Rol</th>
      <th>Activo</th>
      <th>Fecha Registro</th>
    </tr>
  </thead>
  <tbody id="users-table"></tbody>
</table>

<!-- Firebase Compat -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyBi49isj_vzkCzIyJLxsAQ_4n3_zMu4txs",
    authDomain: "buendiashop-f3dcc.firebaseapp.com",
    projectId: "buendiashop-f3dcc",
    storageBucket: "buendiashop-f3dcc.appspot.com",
    messagingSenderId: "181970112547",
    appId: "1:181970112547:web:99072e1c4692bb195e6196",
    measurementId: "G-1Z5CKSCJDZ"
  };

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  const adminUser = "Buendia*]?~?¬£u837jwhwi";
  const adminPass = "&2)3)8:&?3828&/82$:!";

  const usersTable = document.getElementById("users-table");
  const totalUsersEl = document.getElementById("total-users");

  // üîπ Verificar que el admin est√© logueado
  auth.onAuthStateChanged(async user => {
    if(!user){
      // No hay usuario logueado, redirigir
      window.location.href = "login.html";
      return;
    }

    // Opcional: puedes validar email espec√≠fico del admin
    // Solo mostrar admin.html si coincide con nuestro admin
    // En este ejemplo usamos login manual de login.html
    // Si quieres, se puede mejorar para autenticar admin real

    // üîπ Cargar usuarios
    const snapshot = await db.collection("usuarios").get();
    usersTable.innerHTML = "";
    snapshot.forEach(doc => {
      const data = doc.data();
      const fecha = data.fechaRegistro ? data.fechaRegistro.toDate().toLocaleString() : "";
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${data.nombre}</td>
        <td>${data.email}</td>
        <td>${data.rol}</td>
        <td>${data.activo}</td>
        <td>${fecha}</td>
      `;
      usersTable.appendChild(tr);
    });
    totalUsersEl.textContent = `Total de usuarios: ${snapshot.size}`;
  });

  // üîπ Logout
  function logout(){
    auth.signOut().then(()=> window.location.href="login.html");
  }

  console.log("Firebase Admin inicializado:", firebase.app().name);
</script>

</body>
</html>
