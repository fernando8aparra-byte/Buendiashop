<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Admin - Buendía Shop</title>
<style>
body {font-family: Inter, sans-serif; background:#f9f9f9; margin:0; padding:0;}
header{background:#7c4dff;color:#fff;padding:16px;text-align:center;font-size:20px;font-weight:700;}
main{max-width:900px;margin:20px auto;background:#fff;padding:20px;border-radius:12px;box-shadow:0 8px 20px rgba(0,0,0,0.08);}
input, select, textarea, button {width:100%;padding:12px;margin:6px 0;border-radius:6px;border:1px solid #ddd;}
button {background:#7c4dff;color:#fff;border:none;cursor:pointer;font-weight:700;}
button:hover {opacity:0.9;}
.product-list {margin-top:30px;}
.product-item {display:flex;justify-content:space-between;align-items:center;padding:12px;border-bottom:1px solid #ddd;}
.product-item img {width:60px;height:60px;object-fit:cover;border-radius:6px;}
</style>
</head>
<body>

<header>Panel de Administrador - Buendía Shop</header>

<main>
<h2>Agregar Producto</h2>
<form id="productForm">
    <input type="text" id="name" placeholder="Nombre del producto" required>
    <textarea id="description" placeholder="Descripción" required></textarea>
    <input type="number" id="price" placeholder="Precio (solo números)" required>
    <select id="category" required>
        <option value="">Selecciona categoría</option>
        <option value="gorras">Gorras</option>
        <option value="camisetas">Camisetas</option>
        <option value="sudaderas">Sudaderas</option>
        <option value="tenis">Tenis</option>
        <option value="cintos">Cintos</option>
        <option value="fragancias">Fragancias</option>
        <option value="relojes">Relojes</option>
        <option value="pantalones">Pantalones</option>
    </select>
    <input type="file" id="image" accept="image/*" required>
    <button type="submit">Subir Producto</button>
</form>

<h2>Productos Subidos</h2>
<div class="product-list" id="productList">
    <!-- Productos existentes se mostrarán aquí -->
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-firestore.js";
import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-storage.js";

const firebaseConfig = {
  apiKey: "AIzaSyBi49isj_vzkCzIyJLxsAQ_4n3_zMu4txs",
  authDomain: "buendiashop-f3dcc.firebaseapp.com",
  projectId: "buendiashop-f3dcc",
  storageBucket: "buendiashop-f3dcc.appspot.com",
  messagingSenderId: "181970112547",
  appId: "1:181970112547:web:5b5372bdb58033ba5e6196",
  measurementId: "G-MKP6G4V2KW"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const storage = getStorage(app);

const form = document.getElementById('productForm');
const productList = document.getElementById('productList');

async function cargarProductos() {
    productList.innerHTML = '';
    const querySnapshot = await getDocs(collection(db, "productos"));
    querySnapshot.forEach(docSnap => {
        const data = docSnap.data();
        const div = document.createElement('div');
        div.className = 'product-item';
        div.innerHTML = `
            <span>${data.nombre} - $${data.precio.toLocaleString()}</span>
            <img src="${data.imagen}" alt="${data.nombre}">
            <button onclick="eliminarProducto('${docSnap.id}')">Eliminar</button>
        `;
        productList.appendChild(div);
    });
}

async function eliminarProducto(id) {
    await deleteDoc(doc(db, "productos", id));
    cargarProductos();
}

form.addEventListener('submit', async (e) => {
    e.preventDefault();
    const name = document.getElementById('name').value;
    const description = document.getElementById('description').value;
    const price = parseFloat(document.getElementById('price').value);
    const category = document.getElementById('category').value;
    const imageFile = document.getElementById('image').files[0];

    // Subir imagen a Storage
    const storageRef = ref(storage, `productos/${imageFile.name}_${Date.now()}`);
    await uploadBytes(storageRef, imageFile);
    const imageURL = await getDownloadURL(storageRef);

    // Guardar producto en Firestore
    await addDoc(collection(db, "productos"), {
        nombre: name,
        descripcion: description,
        precio: price,
        categoria: category,
        imagen: imageURL,
        fecha: new Date()
    });

    form.reset();
    cargarProductos();
    alert('Producto subido correctamente.');
});

window.eliminarProducto = eliminarProducto;

// Cargar productos al iniciar
cargarProductos();
</script>

</body>
</html>
