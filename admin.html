<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Panel de Administrador</title>
  <style>
    body { font-family: Arial; margin: 30px; }
    input, textarea { width: 100%; margin: 6px 0; padding: 8px; }
    button { margin-top: 10px; padding: 10px; cursor: pointer; }
    img { max-width: 100px; margin-top: 10px; }
    .producto { border: 1px solid #ccc; padding: 10px; margin: 10px 0; }
  </style>
</head>
<body>

<h2>Panel de Administrador</h2>

<h3>Agregar nuevo producto</h3>

<input id="nombre" placeholder="Nombre del producto">
<textarea id="descripcion" placeholder="Descripción"></textarea>
<input id="precio" type="number" placeholder="Precio">
<input id="imagenArchivo" type="file">
<input id="imagenURL" placeholder="O pega una URL de imagen">

<button onclick="subirProducto()">Subir Producto</button>

<hr>

<h3>Productos existentes</h3>
<div id="listaProductos"></div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>

<script>
// Tu configuración corregida
const firebaseConfig = {
  apiKey: "AIzaSyBi49isj_vzkCzIyJLxsAQ_4n3_zMu4txs",
  authDomain: "buendiashop-f3dcc.firebaseapp.com",
  projectId: "buendiashop-f3dcc",
  storageBucket: "buendiashop-f3dcc.appspot.com",
  messagingSenderId: "181970112547",
  appId: "1:181970112547:web:5b5372bdb58033ba5e6196",
  measurementId: "G-MKP6G4V2KW"
};

firebase.initializeApp(firebaseConfig);

const db = firebase.firestore();
const storage = firebase.storage();

async function subirProducto(){
  const nombre = document.getElementById("nombre").value;
  const descripcion = document.getElementById("descripcion").value;
  const precio = Number(document.getElementById("precio").value);
  const archivo = document.getElementById("imagenArchivo").files[0];
  const imagenURLManual = document.getElementById("imagenURL").value;

  let imagenFinal = imagenURLManual;

  if(archivo){
    const ref = storage.ref("productos/" + archivo.name);
    await ref.put(archivo);
    imagenFinal = await ref.getDownloadURL();
  }

  await db.collection("productos").add({ nombre, descripcion, precio, imagen: imagenFinal });

  alert("Producto subido ✅");
  location.reload();
}

function cargarProductos(){
  db.collection("productos").onSnapshot(snapshot => {
    document.getElementById("listaProductos").innerHTML = "";
    snapshot.forEach(doc => {
      const p = doc.data();
      document.getElementById("listaProductos").innerHTML += `
        <div class="producto">
          <img src="${p.imagen}">
          <h4>${p.nombre}</h4>
          <p>${p.descripcion}</p>
          <strong>$${p.precio}</strong><br>
          <button onclick="eliminar('${doc.id}')">Eliminar</button>
        </div>`;
    });
  });
}

function eliminar(id){
  db.collection("productos").doc(id).delete();
}

cargarProductos();
</script>

</body>
</html>
