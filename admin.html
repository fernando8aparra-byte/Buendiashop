<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin - Buendía Shop</title>
<style>
:root {
  --bg: #ffffff;
  --text: #111;
  --accent: #7c4dff;
  --card-bg: #f9f9f9;
}
body { font-family: Arial, sans-serif; background: var(--bg); margin:0; padding:0; }
header { background: var(--card-bg); padding: 15px; text-align:center; font-size:20px; font-weight:bold; }
main { max-width: 800px; margin:auto; padding:20px; }
form { display:flex; flex-direction:column; gap:12px; background:#fff; padding:20px; border-radius:10px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
input, select { padding:10px; font-size:16px; border-radius:6px; border:1px solid #ccc; }
button { padding:12px; font-size:16px; background:var(--accent); color:#fff; border:none; border-radius:8px; cursor:pointer; }
button:hover { opacity:0.9; }
</style>
</head>
<body>

<header>Panel de Administración</header>

<main>
  <h2>Agregar Producto</h2>
  <form id="productForm">
    <input type="text" id="productName" placeholder="Nombre del producto" required>
    <textarea id="productDesc" placeholder="Descripción del producto" required></textarea>
    <input type="text" id="productPrice" placeholder="Precio del producto (ej: 3,000.00)" required>
    
    <select id="productCategory" required>
      <option value="">Selecciona categoría</option>
      <option value="gorras">Gorras</option>
      <option value="camisetas">Camisetas</option>
      <option value="cintos">Cintos</option>
      <option value="pantalones">Pantalones</option>
      <option value="tenis">Tenis</option>
      <option value="sudaderas">Sudaderas</option>
    </select>
    
    <select id="productType" required>
      <option value="">Tipo de producto</option>
      <option value="normal">Normal</option>
      <option value="principal">Principal</option>
      <option value="carrusel">Carrusel</option>
    </select>
    
    <label>
      Habilitado
      <input type="checkbox" id="productEnabled" checked>
    </label>
    
    <input type="file" id="productImage" accept="image/*">
    <button type="submit">Subir Producto</button>
  </form>
</main>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

<script>
  // Configuración de Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyBi49isj_vzkCzIyJLxsAQ_4n3_zMu4txs",
    authDomain: "buendiashop-f3dcc.firebaseapp.com",
    projectId: "buendiashop-f3dcc",
    storageBucket: "buendiashop-f3dcc.appspot.com",
    messagingSenderId: "181970112547",
    appId: "1:181970112547:web:5b5372bdb58033ba5e6196",
    measurementId: "G-MKP6G4V2KW"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
  const storage = firebase.storage();

  const productForm = document.getElementById('productForm');
  const productImage = document.getElementById('productImage');

  productForm.addEventListener('submit', async (e) => {
    e.preventDefault();

    const name = document.getElementById('productName').value.trim();
    const desc = document.getElementById('productDesc').value.trim();
    const priceRaw = document.getElementById('productPrice').value.replace(/,/g, '');
    const price = parseFloat(priceRaw);
    const category = document.getElementById('productCategory').value;
    const type = document.getElementById('productType').value;
    const enabled = document.getElementById('productEnabled').checked;

    if (!name || !desc || !price || !category || !type) {
      alert('Rellena todos los campos.');
      return;
    }

    try {
      let imageUrl = '';

      if (productImage.files.length > 0) {
        const file = productImage.files[0];
        const storageRef = storage.ref(`productos/${file.name}`);
        const snapshot = await storageRef.put(file);
        imageUrl = await snapshot.ref.getDownloadURL();
      }

      const docId = name.replace(/\s+/g, '_'); // id único
      await db.collection('productos').doc(docId).set({
        nombre: name,
        descripcion: desc,
        precio: price,
        categoria: category,
        tipo: type,
        imagen: imageUrl,
        habilitado: enabled
      });

      alert('Producto subido correctamente ✅');
      productForm.reset();

    } catch (err) {
      console.error(err);
      alert('Error al subir producto: ' + err.message);
    }
  });
</script>

</body>
</html>
