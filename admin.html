<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Administrador - Boutique Buendía</title>
<style>
:root {
  --bg: #f5f5f5;
  --text: #111;
  --card-bg: #fff;
  --accent: #7c4dff;
  --shadow: 0 8px 20px rgba(0,0,0,0.08);
}
body{background:var(--bg);font-family:Inter,system-ui,sans-serif;margin:0;padding:0;color:var(--text);}
header{background:var(--card-bg);padding:16px;box-shadow:0 2px 8px rgba(0,0,0,0.1);font-weight:700;font-size:20px;}
main{max-width:1200px;margin:auto;padding:20px;}
form{background:#fff;padding:20px;border-radius:10px;box-shadow:var(--shadow);margin-bottom:20px;display:flex;flex-direction:column;gap:12px;}
input, select, textarea{padding:10px;border:1px solid #ccc;border-radius:6px;font-size:14px;width:100%;}
button{background:var(--accent);color:#fff;padding:12px;border:none;border-radius:8px;font-weight:600;cursor:pointer;}
button:hover{opacity:0.9;}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:22px;}
.card{background:#fff;padding:12px;border-radius:10px;box-shadow:var(--shadow);display:flex;flex-direction:column;gap:6px;}
.card img{width:100%;height:150px;object-fit:contain;background:#f9f9f9;}
.card button{background:#ff5252;}
</style>
</head>
<body>

<header>Panel de Administración - Boutique Buendía</header>

<main>
<h2>Agregar Producto</h2>
<form id="productForm">
  <select id="categoria" required>
    <option value="">Selecciona categoría</option>
    <option value="gorras">Gorras</option>
    <option value="camisetas">Camisetas</option>
    <option value="pantalones">Pantalones</option>
    <option value="tenis">Tenis</option>
    <option value="sudaderas">Sudaderas</option>
  </select>
  <input type="text" id="nombre" placeholder="Nombre del producto" required>
  <textarea id="descripcion" placeholder="Descripción"></textarea>
  <input type="number" id="precio" placeholder="Precio" required>
  <input type="file" id="imagen" accept="image/*" required>
  <button type="submit">Agregar Producto</button>
</form>

<h2>Productos Subidos</h2>
<section class="grid" id="productosGrid"></section>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-firestore.js";
import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-storage.js";

const firebaseConfig = {
  apiKey: "AIzaSyBi49isj_vzkCzIyJLxsAQ_4n3_zMu4txs",
  authDomain: "buendiashop-f3dcc.firebaseapp.com",
  projectId: "buendiashop-f3dcc",
  storageBucket: "buendiashop-f3dcc.appspot.com",
  messagingSenderId: "181970112547",
  appId: "1:181970112547:web:5b5372bdb58033ba5e6196",
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const storage = getStorage(app);

const productForm = document.getElementById('productForm');
const productosGrid = document.getElementById('productosGrid');

productForm.addEventListener('submit', async (e) => {
  e.preventDefault();
  const nombre = document.getElementById('nombre').value.trim();
  const descripcion = document.getElementById('descripcion').value.trim();
  const precio = parseFloat(document.getElementById('precio').value);
  const categoria = document.getElementById('categoria').value;
  const imagenFile = document.getElementById('imagen').files[0];

  if(!nombre || !precio || !categoria || !imagenFile) return alert('Completa todos los campos');

  // Subir imagen
  const storageRef = ref(storage, 'productos/' + imagenFile.name);
  await uploadBytes(storageRef, imagenFile);
  const imagenURL = await getDownloadURL(storageRef);

  // Guardar en Firestore
  await addDoc(collection(db, 'productos'), {
    nombre,
    descripcion,
    precio,
    categoria,
    imagen: imagenURL
  });

  alert('Producto agregado correctamente');
  productForm.reset();
  cargarProductos();
});

// Cargar productos
async function cargarProductos(){
  productosGrid.innerHTML = '';
  const snapshot = await getDocs(collection(db,'productos'));
  snapshot.docs.forEach(docu=>{
    const p = docu.data();
    const card = document.createElement('div');
    card.className = 'card';
    card.innerHTML = `
      <img src="${p.imagen}" alt="${p.nombre}">
      <div><strong>${p.nombre}</strong></div>
      <div>$${p.precio.toLocaleString('es-MX')}</div>
      <button onclick="eliminarProducto('${docu.id}')">Eliminar</button>
    `;
    productosGrid.appendChild(card);
  });
}

window.eliminarProducto = async function(id){
  if(confirm('¿Eliminar este producto?')){
    await deleteDoc(doc(db,'productos',id));
    cargarProductos();
  }
}

// Inicializar
cargarProductos();
</script>

</body>
</html>
