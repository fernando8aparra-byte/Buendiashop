<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Efraín Shop - Pago con PayPal</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
  <style>
    /* =============================================
       ESTILO CLON EXACTO DE DROP-SHOP.MX
       ============================================= */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body {
      font-family: 'Poppins', sans-serif;
      background: #ffffff;
      color: #111111;
      font-size: 16px;
      line-height: 1.6;
      letter-spacing: 0.025em;
      -webkit-font-smoothing: antialiased;
    }
    h1, h2, h3 { text-transform: uppercase; letter-spacing: 1.2px; }
    h1 { font-weight: 800; font-size: 3.75rem; line-height: 1.1; letter-spacing: -0.025em; }
    h2 { font-weight: 700; font-size: 2.25rem; line-height: 1.2; letter-spacing: 0.05em; text-align: center; margin-bottom: 32px; }
    h3 { font-weight: 600; font-size: 1.5rem; line-height: 1.3; letter-spacing: 0.025em; }

    /* HEADER */
    .header {
      position: sticky; top: 0; background: #fff; border-bottom: 1px solid #eee;
      z-index: 1000; padding: 16px 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.03);
    }
    .header-inner {
      display: grid; grid-template-columns: auto 1fr auto auto; align-items: center;
      gap: 16px; max-width: 1400px; margin: 0 auto;
    }
    .logo { font-weight: 900; font-size: 1.5rem; text-transform: uppercase; letter-spacing: 1.5px; color: #111; }

    /* MAIN */
    .main-container { max-width: 1300px; margin: 0 auto; padding: 40px 20px; }
    .products-grid { display: grid; gap: 32px; margin-top: 48px; }
    @media (max-width: 480px) { .products-grid { grid-template-columns: repeat(2, 1fr); } }
    @media (min-width: 481px) and (max-width: 900px) { .products-grid { grid-template-columns: repeat(3, 1fr); } }
    @media (min-width: 901px) { .products-grid { grid-template-columns: repeat(4, 1fr); } }

    .product-card {
      text-align: center; cursor: pointer; transition: transform 0.3s ease;
      padding: 20px; background: #fafafa; border-radius: 16px;
    }
    .product-card:hover { transform: translateY(-10px); }
    .product-card img { width: 100%; height: 280px; object-fit: contain; padding: 24px; }
    .card-info h3 { font-weight: 700; font-size: 1.25rem; line-height: 1.4; letter-spacing: 0.015em; margin-bottom: 8px; }
    .desc { font-size: 0.875rem; color: #555; margin-bottom: 12px; height: 44px; overflow: hidden; }
    .price { font-weight: 800; font-size: 1.875rem; line-height: 1.2; color: #111; }
    .old-price { font-size: 1rem; color: #999; text-decoration: line-through; margin-right: 8px; }
    .offer-price { color: #e63946; font-weight: 900; }
    .add-btn {
      background: #000; color: #fff; border: none; padding: 12px 24px; border-radius: 8px;
      font-size: 0.9rem; font-weight: 700; text-transform: uppercase; cursor: pointer;
      margin-top: 16px; width: 100%; transition: all 0.2s;
    }
    .add-btn:hover { background: #111; transform: translateY(-2px); }

    /* CARRITO LATERAL */
    .cart-sidebar {
      position: fixed; top: 0; right: -340px; width: 320px; max-width: 100vw; height: 100%;
      background: #fff; border-left: 1px solid #eee; transition: right 0.3s ease;
      z-index: 1200; display: flex; flex-direction: column; box-shadow: -4px 0 20px rgba(0,0,0,0.08);
    }
    .cart-sidebar.open { right: 0; }
    .cart-header { padding: 20px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
    .cart-header h3 { font-weight: 800; font-size: 1.3rem; text-transform: uppercase; }
    .cart-items { flex: 1; overflow-y: auto; padding: 20px; }
    .cart-item { display: flex; align-items: center; gap: 16px; padding: 16px 0; border-bottom: 1px solid #eee; }
    .cart-item img.thumb { width: 70px; height: 70px; object-fit: contain; background: #fafafa; border-radius: 8px; padding: 8px; }
    .cart-item > div { flex: 1; }
    .cart-item button { background: none; border: none; color: #999; font-size: 20px; cursor: pointer; }
    .cart-footer { padding: 20px; border-top: 1px solid #eee; }
    .cart-total { text-align: right; font-weight: 800; font-size: 1.4rem; margin-bottom: 16px; }

    /* NUEVO: IR A PAGAR + BOTÓN PAYPAL */
    .go-to-pay {
      font-weight: 800;
      font-size: 1.3rem;
      text-transform: uppercase;
      letter-spacing: 1.2px;
      text-align: center;
      margin: 20px 0 16px;
      color: #111;
    }
    #paypal-button-container {
      margin: 0 auto 20px;
      max-width: 280px;
    }
    #message {
      margin-top: 20px;
      padding: 12px 16px;
      border-radius: 8px;
      font-weight: 500;
      min-height: 20px;
      text-align: center;
    }
    #message.success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
    #message.error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    #message.cancel { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }

    /* TOAST */
    .toast {
      position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%) translateY(20px);
      background: #000; color: #fff; padding: 14px 28px; border-radius: 8px;
      font-weight: 700; font-size: 1rem; box-shadow: 0 8px 25px rgba(0,0,0,0.15);
      opacity: 0; visibility: hidden; transition: all 0.35s ease; z-index: 1300; text-transform: uppercase;
    }
    .toast.show { opacity: 1; visibility: visible; transform: translateX(-50%) translateY(0); }

    /* RESPONSIVE */
    @media (max-width: 480px) {
      .main-container { padding: 30px 15px; }
      .product-card img { height: 220px; }
    }
  </style>
</head>
<body>

  <!-- HEADER -->
  <header class="header">
    <div class="header-inner">
      <button id="menuBtn">Menu</button>
      <div class="logo">EFRAÍN</div>
      <button id="searchBtn">Search</button>
      <button id="cartBtn">Cart</button>
    </div>
  </header>

  <!-- MAIN -->
  <main class="main-container">
    <h2>Nuevos Productos</h2>
    <div class="products-grid" id="productsGrid">
      <!-- Productos generados por JS -->
    </div>
  </main>

  <!-- CARRITO LATERAL -->
  <aside class="cart-sidebar" id="cartSidebar">
    <div class="cart-header">
      <h3>Tu Carrito</h3>
      <button id="closeCart">X</button>
    </div>
    <div class="cart-items" id="cartItems">
      <p class="empty-cart">Tu carrito está vacío</p>
    </div>
    <div class="cart-footer">
      <div class="cart-total" id="cartTotal">Total: $0</div>
      <!-- NUEVO: IR A PAGAR -->
      <div class="go-to-pay">Ir a Pagar</div>
      <!-- BOTÓN PAYPAL OFICIAL -->
      <div id="paypal-button-container"></div>
      <div id="message"></div>
    </div>
  </aside>

  <!-- TOAST -->
  <div class="toast" id="toast"></div>

  <!-- SDK PAYPAL (SANDBOX) -->
  <script src="https://www.paypal.com/sdk/js?client-id=Ac-wWdXisC56JfcJK1clrMaIe-Wpcyd4C_6gkoAn12k_M-LlGEJOTdhh6aZwghHM0k1lrJl3nQdE0HCS&currency=MXN&intent=capture"></script>

  <script>
    // =============================================
    // DATOS DE PRODUCTOS (LOCALSTORAGE)
    // =============================================
    let products = JSON.parse(localStorage.getItem('products')) || [
      { id: 1, name: "Gorra GALAXY CT", price: 18000, desc: "Edición limitada 24K", img: "https://imgfz.com/i/TBumyjZ.webp" },
      { id: 2, name: "Camiseta Oversize", price: 850, desc: "Algodón premium", img: "https://imgfz.com/i/rTJ1Xnl.webp" }
    ];
    if (!localStorage.getItem('products')) localStorage.setItem('products', JSON.stringify(products));

    let cart = JSON.parse(localStorage.getItem('cart')) || [];
    const productsGrid = document.getElementById('productsGrid');
    const cartItems = document.getElementById('cartItems');
    const cartTotal = document.getElementById('cartTotal');
    const cartSidebar = document.getElementById('cartSidebar');
    const closeCart = document.getElementById('closeCart');
    const cartBtn = document.getElementById('cartBtn');
    const toast = document.getElementById('toast');

    // =============================================
    // RENDERIZAR PRODUCTOS
    // =============================================
    function renderProducts() {
      productsGrid.innerHTML = '';
      products.forEach(p => {
        const card = document.createElement('div');
        card.className = 'product-card';
        card.innerHTML = `
          <img src="${p.img}" alt="${p.name}">
          <div class="card-info">
            <h3>${p.name}</h3>
            <p class="desc">${p.desc}</p>
            <p class="price">$${p.price.toLocaleString()}</p>
            <button class="add-btn" onclick="addToCart(${p.id})">Agregar</button>
          </div>
        `;
        productsGrid.appendChild(card);
      });
    }

    // =============================================
    // CARRITO
    // =============================================
    function addToCart(id) {
      const product = products.find(p => p.id === id);
      const existing = cart.find(i => i.id === id);
      if (existing) existing.qty++;
      else cart.push({ ...product, qty: 1 });
      localStorage.setItem('cart', JSON.stringify(cart));
      updateCart();
      showToast('¡Agregado!');
    }

    function removeFromCart(index) {
      cart.splice(index, 1);
      localStorage.setItem('cart', JSON.stringify(cart));
      updateCart();
    }

    function updateCart() {
      cartItems.innerHTML = '';
      let total = 0;
      if (cart.length === 0) {
        cartItems.innerHTML = '<p class="empty-cart">Tu carrito está vacío</p>';
        document.querySelector('.go Rong-to-pay')?.style.display = 'none';
        document.getElementById('paypal-button-container').innerHTML = '';
        return;
      }
      document.querySelector('.go-to-pay').style.display = 'block';

      cart.forEach((item, i) => {
        total += item.price * item.qty;
        const div = document.createElement('div');
        div.className = 'cart-item';
        div.innerHTML = `
          <img src="${item.img}" alt="${item.name}" class="thumb">
          <div>
            <div>${item.name}</div>
            <small>x${item.qty} • $${(item.price * item.qty).toLocaleString()}</small>
          </div>
          <button onclick="removeFromCart(${i})">X</button>
        `;
        cartItems.appendChild(div);
      });
      cartTotal.textContent = `Total: $${total.toLocaleString()}`;
      renderPayPalButton(total);
    }

    // =============================================
    // BOTÓN PAYPAL OFICIAL (SMART BUTTONS)
    // =============================================
    function renderPayPalButton(amount) {
      const container = document.getElementById('paypal-button-container');
      container.innerHTML = ''; // Limpiar botón anterior

      paypal.Buttons({
        createOrder: function() {
          return actions.order.create({
            purchase_units: [{
              amount: { value: (amount / 100).toFixed(2) } // MXN: 18000 → 180.00
            }]
          });
        },
        onApprove: function(data, actions) {
          return actions.order.capture().then(details => {
            document.getElementById('message').innerHTML = `
              ¡Pago exitoso! Orden: ${details.id}<br>
              Gracias, ${details.payer.name.given_name}
            `;
            document.getElementById('message').className = 'success';
            cart = [];
            localStorage.setItem('cart', '[]');
            updateCart();
            cartSidebar.classList.remove('open');
          });
        },
        onCancel: function() {
          document.getElementById('message').innerHTML = 'Pago cancelado.';
          document.getElementById('message').className = 'cancel';
        },
        onError: function(err) {
          document.getElementById('message').innerHTML = 'Error: ' + err;
          document.getElementById('message').className = 'error';
        }
      }).render('#paypal-button-container');
    }

    // =============================================
    // EVENTOS
    // =============================================
    cartBtn.onclick = () => cartSidebar.classList.add('open');
    closeCart.onclick = () => cartSidebar.classList.remove('open');

    function showToast(msg) {
      toast.textContent = msg;
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 2500);
    }

    // INICIO
    renderProducts();
    updateCart();

    /* =============================================
       INSTRUCCIONES:
       - Client ID: Ac-wWdXisC56JfcJK1clrMaIe-Wpcyd4C_6gkoAn12k_M-LlGEJOTdhh6aZwghHM0k1lrJl3nQdE0HCS (sandbox)
       - Prueba con cuenta sandbox: https://developer.paypal.com
       - Para producción: cambia &client-id=... y quita &environment=sandbox
       ============================================= */
  </script>
</body>
</html>
