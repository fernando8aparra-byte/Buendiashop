<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Compras - Efraín Shop</title>
  <link rel="stylesheet" href="css/styles.css">
  <style>
    /* ... Tus estilos existentes ... */

    /* ESTILOS PARA IMPRESIÓN */
    @media print {
      body * { visibility: hidden; }
      .printable-order, .printable-order * { visibility: visible; }
      .printable-order {
        position: absolute; left: 0; top: 0; width: 100%;
        padding: 20px; background: white; font-size: 14px;
      }
      .print-btn { display: none !important; }
      .header, .sort-btn, .notifications, .toast { display: none !important; }
    }

    /* BOTÓN DE IMPRESIÓN */
    .print-btn {
      background: none; border: none; cursor: pointer; padding: 4px; margin-top: 10px;
      display: inline-flex; align-items: center; font-size: 0.9rem; color: #333;
    }
    .print-btn svg {
      width: 18px; height: 18px; stroke: currentColor; fill: none;
    }
  </style>
</head>
<body>
  <!-- ... Header y resto igual ... -->

  <main class="main-container">
    <div style="position:relative; margin-bottom:20px;">
      <button class="sort-btn" id="sortBtn">
        <svg viewBox="0 0 24 24"><path d="M7 14l5-5 5 5z" fill="currentColor"/><path d="M7 10l5 5 5-5z" fill="currentColor"/></svg>
        Ordenar
      </button>
    </div>
    <div class="orders-container" id="ordersContainer">
      <!-- Las compras se inyectan aquí -->
    </div>
  </main>

  <!-- TOAST -->
  <div class="toast" id="toast"></div>

  <!-- SCRIPTS -->
  <script type="module">
    // Ejemplo de inyección de tarjeta (esto normalmente viene de compras.js)
    document.addEventListener('DOMContentLoaded', () => {
      const container = document.getElementById('ordersContainer');
      
      // Ejemplo de una orden
      const order = {
        id: "ORD-12345",
        total: "$1,250.00",
        date: "08 Nov 2025, 14:30",
        products: [
          { name: "Camiseta Negra", qty: 2, price: "$300.00" },
          { name: "Gorra Efraín", qty: 1, price: "$650.00" }
        ],
        address: {
          calle: "Av. Principal 123",
          colonia: "Centro",
          municipio: "Ciudad de México",
          estado: "CDMX",
          cp: "06000",
          referencia: "Entre calle 1 y 2, casa gris"
        }
      };

      const card = createOrderCard(order);
      container.innerHTML = card;
      setupPrintButtons();
    });

    function createOrderCard(order) {
      const productsHTML = order.products.map(p => 
        `<div class="order-product">
          <span>${p.qty}x ${p.name}</span>
          <span>${p.price}</span>
        </div>`
      ).join('');

      const addressLines = `
        <strong>Dirección:</strong> ${order.address.calle}<br>
        <strong>Colonia:</strong> ${order.address.colonia}<br>
        <strong>Municipio:</strong> ${order.address.municipio}<br>
        <strong>Estado:</strong> ${order.address.estado}<br>
        <strong>Código Postal:</strong> ${order.address.cp}<br>
        ${order.address.referencia ? `<strong>Referencia:</strong> ${order.address.referencia}<br>` : ''}
      `;

      return `
        <div class="order-card printable-order" id="order-${order.id}">
          <div class="order-header">Detalles de la Compra</div>
          <div class="order-id">Orden: ${order.id}</div>
          <div class="order-total">Total: ${order.total}</div>
          
          <div class="order-products">
            ${productsHTML}
          </div>

          <div class="order-address">
            ${addressLines}
          </div>

          <div class="order-date">${order.date}</div>

          <!-- BOTÓN IMPRIMIR -->
          <button class="print-btn" onclick="printOrder('order-${order.id}')">
            <svg viewBox="0 0 24 24"><path d="M18 7H6V3h12v4zm-2 6c.55 0 1-.45 1-1s-.45-1-1-1-1 .45-1 1 .45 1 1 1zm2 8H6v-4H4v-2h16v2h-2v4zm0-6H6v-2h12v2z" fill="none" stroke="currentColor" stroke-width="2"/></svg>
            Imprimir
          </button>
        </div>
      `;
    }

    // Función para imprimir solo la orden seleccionada
    window.printOrder = function(orderId) {
      const orderElement = document.getElementById(orderId);
      if (!orderElement) return;

      // Clonar para no afectar el DOM
      const printWindow = window.open('', '', 'width=800,height=600');
      const printContent = orderElement.outerHTML;

      printWindow.document.write(`
        <!DOCTYPE html>
        <html><head><title>Orden ${orderId}</title>
        <style>
          body { font-family: Arial, sans-serif; padding: 30px; background: white; color: black; }
          .order-card { border: 1px solid #ddd; border-radius: 12px; padding: 20px; max-width: 600px; margin: 0 auto; }
          .order-header { font-weight: bold; font-size: 1.3rem; margin-bottom: 10px; }
          .order-id { font-size: 0.9rem; color: #555; }
          .order-total { font-weight: bold; font-size: 1.4rem; margin: 12px 0; color: #000; }
          .order-products { background: #f9f9f9; padding: 12px; border-radius: 8px; margin: 12px 0; }
          .order-product { display: flex; justify-content: space-between; font-size: 0.95rem; margin: 6px 0; }
          .order-address { font-size: 1rem; line-height: 1.6; margin: 14px 0; }
          .order-address strong { display: inline-block; width: 120px; }
          .order-date { text-align: right; font-size: 0.85rem; color: #777; margin-top: 15px; }
          @page { margin: 1cm; }
        </style>
        </head><body>
          ${printContent}
          <script>window.onload = function() { window.print(); window.close(); }<\/script>
        </body></html>
      `);
      printWindow.document.close();
    };

    function setupPrintButtons() {
      // Si tienes varias tarjetas, este bucle las activa
      document.querySelectorAll('.print-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.stopPropagation();
        });
      });
    }
  </script>
</body>
</html>
